
⏺ 启动API Server

  使用以下方式启动：

  方法1：使用启动脚本

  chmod +x start_pdf_api_server.sh
  ./start_pdf_api_server.sh

  方法2：分步启动

  # 1. 先启动vLLM服务器
  bash ocrflux/server.sh ChatDOC/OCRFlux-3B 8001

  # 2. 再启动FastAPI服务器
  pip install -r requirements-fastapi.txt
  uvicorn fastapi_pdf_server:app --host 0.0.0.0 --port 8000 --loop uvloop

  接口结构和能力

  核心接口：

  1. 异步解析接口 /parse (POST)
    - 提交PDF后立即返回job_id
    - 后台异步处理，支持高并发
    - 支持优先级队列
  2. 同步解析接口 /parse-sync (POST)
    - 等待处理完成后返回结果
    - 适合小文件或需要立即结果的场景
  3. 状态查询 /status/{job_id} (GET)
    - 查询任务进度和状态
    - 返回处理进度百分比
  4. 结果获取 /result/{job_id}/markdown (GET)
    - 流式返回Markdown结果
    - 支持大文件下载
  5. 健康检查 /health (GET)
    - 服务器状态和队列信息
  6. 统计信息 /stats (GET)
    - 处理统计和性能指标

  高性能异步特性

  1. 并发控制

  # 全局信号量控制并发
  semaphore = asyncio.Semaphore(MAX_CONCURRENT_REQUESTS)

  # 异步任务队列
  request_queue = asyncio.Queue(maxsize=100)

  2. 异步处理流

  - 使用asyncio.TaskGroup并发处理多页
  - 后台worker持续处理队列任务
  - 支持优先级任务插队

  3. 性能优化

  - 使用uvloop事件循环（比默认asyncio快2-4倍）
  - 连接复用（继承client.py的自定义HTTP实现）
  - 流式响应减少内存占用

  4. 可扩展性

  - 支持Docker部署和水平扩展
  - Redis可选用于分布式任务存储
  - Prometheus监控集成

  性能指标

  - 支持20+并发请求
  - 单机可处理100+ PDF/分钟（取决于GPU）
  - 毫秒级响应时间（异步接口）